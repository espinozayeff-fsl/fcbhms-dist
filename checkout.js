!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=33)}({33:function(e,t,n){"use strict";function r(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}n.r(t);var l=function(){function e(){a(this,e)}return d(e,[{key:"verify",value:function(e){for(var t=0;t<e.length;t++)for(var n=e[t],r=n.field,i=n.name,s=n.dataValue?r.dataset.value:r.value,a=0;a<n.checks.length;a++){var o=n.checks[a];if(!("not_empty"!==o||s&&s.trim()))return{status:"invalid",message:i+" is required.",input:r};if("min_length"===o&&s.trim().length<3)return{status:"invalid",message:i+" must be at least 3 characters.",input:r};if("card_num"===o&&!this.cardNumberValidation(s))return{status:"invalid",message:i+" is not valid.",input:r};if("email"===o&&!this.validateEmail(s))return{status:"invalid",message:i+" is not valid.",input:r}}return{status:"valid"}}},{key:"cardNumberValidation",value:function(e){if((e=e.replace(/\D/g,"")).length<13||e.length>19)return!1;var t=e.slice(-1);e=(e=e.slice(0,-1)).split("").reverse();for(var n=0,r=0;r<e.length;++r)r%2==0&&(e[r]=2*e[r]),e[r]>9&&(e[r]=e[r]-9),n=Number(n)+Number(e[r]);return(n=9*Number(n))%10==t}},{key:"validateEmail",value:function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())}}]),e}(),c=function(){function e(){a(this,e),s(this,"formUtil",new l),s(this,"guestBillingAddressAutocompleteData",void 0),s(this,"guestShippingAddressAutocompleteData",void 0),s(this,"addAddressAutocompleteData",void 0),s(this,"total",0),s(this,"user",void 0),s(this,"userMetadata",void 0),s(this,"db",void 0),s(this,"usersTableIdentifier","fcbhUsers"),s(this,"cartId","fcbh_cart"),s(this,"onDataUpdate",void 0)}return d(e,[{key:"getItemsData",value:function(){for(var e={items:[],total:0},t=this.getCart(),n=0;n<t.length;n++){var r=t[n];e.total+=r.subtotal,e.items.push(r)}return e.total=e.total.toFixed(2),e}},{key:"getCart",value:function(){return JSON.parse(localStorage.getItem(this.cartId)||"{}")||[]}},{key:"setCart",value:function(e){localStorage.setItem(this.cartId,JSON.stringify(e))}},{key:"getUserData",value:function(e){var t=this;return new Promise((function(n,r){FCBH.firebaseDb.collection(t.usersTableIdentifier).doc(e).get().then((function(e){n(e.exists)})).catch((function(e){r()}))}))}},{key:"createNewUser",value:function(e){console.log("create new user",e);var t=this;return new Promise((function(n,r){FCBH.firebaseDb.collection(t.usersTableIdentifier).doc(e.uid).set({email:e.email,joined_date:e.metadata.creationTime,name:e.displayName,photo:e.photoURL}).then((function(){n()})).catch((function(e){r()}))}))}},{key:"listenForUpdates",value:function(e){var t=this;FCBH.firebaseDb.collection(t.usersTableIdentifier).doc(e).onSnapshot((function(e){var n=e.data();t.onDataUpdate(n)}))}},{key:"saveAddressToFirebase",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this,n=t.userMetadata.addresses||[];return n.push.apply(n,r(e)),new Promise((function(e,r){FCBH.firebaseDb.collection(t.usersTableIdentifier).doc(t.user.uid).update({addresses:n}).then((function(){e()})).catch((function(e){r(e)}))}))}},{key:"saveOrder",value:function(e){return new Promise((function(t,n){$.post("https://pay.faithcomesbyhearing.com/index.php/store/store_transaction",e).done((function(e){t(e)})).fail((function(e,t,r){n(r)}))}))}},{key:"extractAddress",value:function(e){if(e){for(var t={address:"",city:"",state:"",zip:"",country:""},n=0;n<e.address_components.length;n++)for(var r=e.address_components[n],i=0;i<r.types.length;i++)switch(r.types[i]){case"street_number":t.address=r.short_name;break;case"route":t.address+=" "+r.short_name;break;case"locality":t.city=r.short_name;break;case"administrative_area_level_1":t.state=r.long_name;break;case"country":t.country=r.long_name;break;case"postal_code":t.zip=r.long_name}return t}}}]),e}();function u(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),v(this,"guestBillingAddressField",document.querySelector("#Billing-Address-Street")),v(this,"guestShippingAddressField",document.querySelector("#Shipping-Address-Street")),v(this,"reviewDiv",document.querySelector(".order-item-list")),v(this,"subtotal",document.querySelector(".w-commerce-commercecheckoutsummarylineitem:nth-child(1) > div:nth-child(2)")),v(this,"total",document.querySelector(".w-commerce-commercecheckoutsummarylineitem:nth-child(3) > div:nth-child(2)")),v(this,"guestSelectedShippingAddress",document.querySelector("#Shipping-Address-Street")),v(this,"guestSelectedBillingAddress",document.querySelector("#Billing-Address-Street")),v(this,"email",document.querySelector("#customer-info-email")),v(this,"emailLoggedInUser",document.getElementById("customer-info-email")),v(this,"userFullName",document.querySelector("#shipping-address-name")),v(this,"billingFullName",document.querySelector("#Billing-Address-Name")),v(this,"shippingAddressTwo",document.querySelector("#Shipping-Address-Street-2")),v(this,"billingAddressTwo",document.querySelector("#Billing-Address-Street-2")),v(this,"shippingAddressCity",document.querySelector("#Shipping-Address-City")),v(this,"billingAddressCity",document.querySelector("#Billing-Address-City")),v(this,"shippingAddressState",document.querySelector("#Shipping-Address-State")),v(this,"billingAddressState",document.querySelector("#Billing-Address-State")),v(this,"shippingAddressPostalCode",document.querySelector("#Shipping-Address-Postal-Code")),v(this,"billingAddressPostalCode",document.querySelector("#Billing-Address-Postal-Code")),v(this,"shippingAddressCountryContainer",document.querySelector(".shipping-address #shipping-country")),v(this,"shippingAddressCountryValue",(function(){return document.querySelector("#w-dropdown-toggle-0 > div")})),v(this,"shippingAddressCountryList",(function(){return document.querySelector("#w-dropdown-list-0")})),v(this,"billingAddressCountryContainer",document.querySelector(".billing-address #shipping-country")),v(this,"billingAddressCountryValue",(function(){return document.querySelector("#w-dropdown-toggle-1 > div")})),v(this,"billingAddressCountryList",(function(){return document.querySelector("#w-dropdown-list-1")})),v(this,"billingAddressContainer",document.querySelector(".billing-address")),v(this,"billingEqualsShippingButton",document.querySelector("#same-as-shipping")),v(this,"cardNumberInput",document.getElementById("Payment-Info-Card-Number")),v(this,"cardExpirationInput",document.getElementById("Payment-Info-Card-Expiration-Date")),v(this,"cardCVCInput",document.getElementById("Payment-Info-Card-CVV")),v(this,"addressListContainer",document.querySelector("#address-container")),v(this,"selectAddressText",document.querySelector("#select-address-text")),v(this,"addNewAddressText",document.querySelector("#add-new-address-text")),v(this,"form",document.querySelector("#email-form")),v(this,"addAddressField",document.querySelector(".footer-legal")),v(this,"guestElements",document.querySelectorAll(".footer-legal1")),v(this,"selectedShippingAddress",document.querySelector(".footer-legal")),v(this,"selectedBillingAddress",document.querySelector(".footer-legal")),v(this,"popup",document.querySelector(".footer-legal")),v(this,"overlay",document.querySelector(".footer-legal")),v(this,"popupTitle",document.querySelector(".footer-legal")),v(this,"popupAddressListBlock",document.querySelector(".footer-legal")),v(this,"popupAddNewAddressButton",document.querySelector(".footer-legal")),v(this,"popupAddNewAddressFields",document.querySelector(".footer-legal")),v(this,"updateAddressesButton",document.querySelector(".footer-legal")),v(this,"addNewAddressNameField",document.querySelector(".footer-legal")),v(this,"addNewAddressTwoField",document.querySelector(".footer-legal")),v(this,"verifyNewAddressBlock",document.querySelector(".footer-legal")),v(this,"changeAddressBlock",document.querySelector(".footer-legal")),v(this,"verifyAddressButton",document.querySelector(".footer-legal")),v(this,"closePopupButton",document.querySelector(".footer-legal")),v(this,"verificationBox",document.querySelector("verification-box")),v(this,"phone",document.querySelector(".footer-legal")),v(this,"addNewAddressPhone",document.querySelector(".footer-legal")),v(this,"onChangeSelectedAddressButtonClicked",void 0),v(this,"onSelectedAddressChange",void 0),v(this,"onReviewItemQuantityChange",void 0),v(this,"onReviewItemDelete",void 0),v(this,"onAddressSelectedForBillingVerify",void 0),v(this,"onAddressSelectedForShippingVerify",void 0),v(this,"onVerificationCancelled",void 0),this.overlay.onclick=function(){t.closePopup(),t.verificationBox.style.display="none"},setTimeout((function(){t.processCountryList()}),100)}var t,n,r;return t=e,(n=[{key:"onAddNewAddressClicked",value:function(e){this.openPopup()}},{key:"toogleAddressList",value:function(){this.addressListContainer.style.display="none"===this.addressListContainer.style.display?"block":"none",this.selectAddressText.style.display="none"===this.selectAddressText.style.display?"block":"none",this.addNewAddressText.style.display="none"===this.addNewAddressText.style.display?"block":"none"}},{key:"renderAddressList",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.addressListContainer.lastChild;)this.addressListContainer.removeChild(this.addressListContainer.lastChild);var t=e.map((function(e){return'\n      <label class="default-form__radio-field radio-address w-radio">\n        <input type="radio" name="select-shipping-address"  data-name="select-shipping-address" value="'.concat(e.id,'" class="w-form-formradioinput default-form__radio w-radio-input" />\n        <span class="default-form__label default-form__label--radio w-form-label">\n          ').concat(e.address.trim(),"\n          <br>\n          ").concat(e.address_two.trim(),"\n          <br>\n          ").concat(e.city,", ").concat(e.state," ").concat(e.zip,"\n        </span>\n      </label>\n      ")}));this.addressListContainer.innerHTML=t.join(""),this.appendRadioControls(this.addressListContainer)}},{key:"appendRadioControls",value:function(e){var t,n=this,r=null,i=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=p(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}(e.querySelectorAll('input[type="radio"]'));try{for(i.s();!(t=i.n()).done;)t.value.addEventListener("click",(function(e){e.target.checked&&e.target===r?(e.target.checked=!1,r=null,n.toggleShippingAddress(!1)):e.target.checked&&(r=e.target,n.toggleShippingAddress(!0))}))}catch(e){i.e(e)}finally{i.f()}}},{key:"toggleShippingAddress",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=[this.guestShippingAddressField,this.userFullName,this.shippingAddressTwo,this.shippingAddressCity,this.shippingAddressPostalCode,this.shippingAddressState];t.forEach((function(t){t.required=!e,t.disabled=e}))}},{key:"getCheckedShippingAddress",value:function(){return document.querySelector('input[name="select-shipping-address"]:checked')}},{key:"processCountryList",value:function(){var e=this,t=document.createElement("a");t.href="#",t.classList.add("dropdown-link","w-dropdown-link"),t.dataset.value="USA",t.textContent="United States";var n=t.cloneNode(!0);t.addEventListener("click",(function(t){e.shippingAddressCountryValue().textContent=t.target.textContent,e.shippingAddressCountryValue().dataset.value=t.target.dataset.value,e.shippingAddressCountryValue().dispatchEvent(new MouseEvent("mouseup",{view:window,bubbles:!0,cancelable:!1}))})),this.shippingAddressCountryValue().textContent=t.textContent,this.shippingAddressCountryValue().dataset.value=t.dataset.value,n.addEventListener("click",(function(t){e.billingAddressCountryValue().textContent=t.target.textContent,e.billingAddressCountryValue().dataset.value=t.target.dataset.value,e.billingAddressCountryValue().dispatchEvent(new MouseEvent("mouseup",{view:window,bubbles:!0,cancelable:!1}))})),this.billingAddressCountryValue().textContent=n.textContent,this.billingAddressCountryValue().dataset.value=n.dataset.value,this.cleanAndRenderCountry(this.shippingAddressCountryList(),[t]),this.cleanAndRenderCountry(this.billingAddressCountryList(),[n])}},{key:"cleanAndRenderCountry",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e.lastChild;)e.removeChild(e.lastChild);e.append.apply(e,u(t))}},{key:"refreshReviewItems",value:function(e){var t=e.items;this.reviewDiv.innerHTML="";var n=t.map((function(e,t){return console.log(e),'\n      <div class="order-item" data-id="'.concat(t,'" data-qty="').concat(e.quantity,'">\n        <img src="https://cdn.faithcomesbyhearing.com/resources/fcbh/img/store/products/').concat(e.thumbnail,'" alt="" class="order-item-image loaded" loading="lazy" data-ll-status="loaded">\n        <div class="order-item-info">\n          <div class="order-item-title">').concat(e.title,'</div>\n          <div class="txt-sm txt-qty">\n          ').concat(e.version,'\n          </div>\n          <div class="txt-sm txt-qty">\n          ').concat(e.language,'\n          </div>\n          <div class="order-item-qty">\n            <div class="txt-sm txt-qty">Quantity: </div>\n            <div class="txt-sm txt-qty">').concat(e.quantity,'</div>\n          </div>\n        </div>\n        <div class="order-item-price txt-md">$').concat(e.subtotal.toFixed(2),"USD</div>\n      </div>\n      ")}));this.reviewDiv.innerHTML=n.join(""),this.subtotal.innerHTML="$"+e.total,this.total.innerHTML="$"+e.total}},{key:"setGuestElements",value:function(e){if(e)for(var t=0;t<this.guestElements.length;t++)this.guestElements[t].dataset.guest="false"}},{key:"displaySelectedAddresses",value:function(e,t,n){var r=this;if(t=t||!1,e&&e.length>0){for(var i=e[0],s=0;s<e.length;s++)if(t&&e[s].id==t){i=e[s];break}var a="<p>"+i.full_name+"</p><p>"+i.address+"</p><p>"+i.city+", "+i.state+" "+i.zip+" "+i.country+"</p><p><span class='hover change-address-button' style='color: #9e1e35;text-decoration:underline'>Change</span></p>";if(n){var o="billing"===n?r.selectedBillingAddress:r.selectedShippingAddress;o.innerHTML=a,o.dataset.address=i.id}else r.selectedShippingAddress.innerHTML=r.selectedBillingAddress.innerHTML=a,r.selectedShippingAddress.dataset.address=r.selectedBillingAddress.dataset.address=i.id;var d=document.querySelectorAll(".change-address-button");for(s=0;s<d.length;s++)d[s].onclick=r.onChangeSelectedAddressButtonClicked}else r.selectedShippingAddress.innerHTML=r.selectedBillingAddress.innerHTML="<p><span class='hover' style='text-decoration:underline;color:#9e1e35'>Add a new address</span></p>",r.selectedShippingAddress.querySelector("span").onclick=function(){r.onAddNewAddressClicked("shipping")},r.selectedBillingAddress.querySelector("span").onclick=function(){r.onAddNewAddressClicked("billing")}}},{key:"showVerifyAddressBox",value:function(e){var t=document.getElementById("verify-address-list");if(t.innerHTML="",e&&e.length>0)for(var n=0;n<e.length;n++)t.innerHTML+="<div><label><input value='"+e[n].place_id+"' name='verify-address' type='radio' /><section></section>"+e[n].description+"</label></div>"}},{key:"openPopup",value:function(e,t){t=t||"add-new",this.popup.dataset.field=e||"shipping",this.popup.dataset.prev=this.popup.dataset.view="",this.changePopupView(t),"0px"===this.popup.style.right&&"0"===this.popup.style.right||(this.overlay.style.display="block",this.popup.style.right="0px")}},{key:"changePopupView",value:function(e){this.changeAddressBlock.style.display="none",this.verifyNewAddressBlock.style.display="none",this.popupAddNewAddressFields.style.display="none",e=e||"add-new",this.popup.dataset.prev=this.popup.dataset.view||"",this.popup.dataset.view=e,"add-new"===e?this.popupAddNewAddressFields.style.display="block":"change"===e?this.changeAddressBlock.style.display="block":"verify"===e&&(this.verifyNewAddressBlock.style.display="block")}},{key:"backToPreviousPopupView",value:function(){this.popup.dataset.prev&&this.changePopupView(this.popup.dataset.prev)}},{key:"closePopup",value:function(){this.popup.style.right="-300px",setTimeout((function(){this.overlay.style.display="none"}),510)}},{key:"setChangeAddressPopupAddressList",value:function(e){var t=this;if(t.popupAddressListBlock.innerHTML="",e){var n,r=t.popup.dataset.field||"billing",i=document.getElementById("selected-"+r+"-address");i&&(n=i.dataset.address);for(var s=0;s<e.length;s++){var a=e[s],o=a.id===n||0===s&&!n?"checked":"",d=e[s].address_two?e[s].address_two+"<br>":"",l="<div><label><input type='radio' name='address' data-id="+a.id+" "+o+"/><section></section>"+a.full_name+"<br>"+a.address+"<br>"+d+a.city+", "+a.state+" "+a.zip+"</label></div>";this.popupAddressListBlock.innerHTML+=l}var c=document.querySelectorAll("input[name=address]");for(s=0;s<c.length;s++)c[s].onclick=function(){t.onSelectedAddressChange(this.dataset.id)}}}},{key:"toggleBillingAddressSection",value:function(e){var t="none"===e.style.display;e.style.display=t?"block":"none",e.querySelectorAll("input").forEach((function(e){e.required=t}))}},{key:"setPopupSelectedAddress",value:function(e){for(var t=document.querySelectorAll("input[name=address]"),n=0;n<t.length;n++)if(t[n].dataset.id==e){t[n].checked=!0;break}}},{key:"startLoader",value:function(e){e.value=e.dataset.wait,e.textContent=e.dataset.wait}},{key:"showAddressVerification",value:function(e,t,n){var r=this;e=e||"shipping",r.overlay.style.display="block",r.verificationBox.style.display="block";var i="<h3>Please verify your "+e+" address.</h3><div class='verification-addresses'>";if(!t||0==t.length)return r.verificationBox.innerHTML=i+"<br><br><p style='text-align:center'>No addresses could be found. Please search a different address.</p><br><p id='address-verification-cancel' style='text-decoration:underline;text-align:center'>Cancel</p>",void(document.getElementById("address-verification-cancel").onclick=function(){r.closeAddressVerificationBox()});for(var s=0;s<t.length;s++){var a=t[s];i+="<div class='address-verification-"+e+"'><label><input type='radio' name='address' data-id='"+a.place_id+"' /><section></section>"+a.description+"</label></div>"}i+="</div><div style='text-align:center'><button id='"+e+"-verification-done-button' type='button' class='store-button red'>Done</button><p id='address-verification-cancel' style='text-decoration:underline'>Cancel</p></div>",r.verificationBox.innerHTML=i,document.getElementById(e+"-verification-done-button").onclick=function(){for(var t,n=document.querySelectorAll(".address-verification-"+e+" input"),i=0;i<n.length;i++)if(n[i].checked){t=n[i].dataset.id;break}t&&("shipping"===e?r.onAddressSelectedForShippingVerify(t):"billing"===e&&r.onAddressSelectedForBillingVerify(t))},document.getElementById("address-verification-cancel").onclick=function(){r.closeAddressVerificationBox()}}},{key:"closeAddressVerificationBox",value:function(){this.overlay.style.display="none",this.verificationBox.style.display="none"}},{key:"attachListeners",value:function(e,t,n){for(var r=0;r<t.length;r++)t[r].addEventListener(e,n)}}])&&f(t.prototype,n),r&&f(t,r),e}();function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){C(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,s=e}finally{try{r||null==o.return||o.return()}finally{if(i)throw s}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return w(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function A(e,t,n,r,i,s,a){try{var o=e[s](a),d=o.value}catch(e){return void n(e)}o.done?t(d):Promise.resolve(d).then(r,i)}function S(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){A(s,r,i,a,o,"next",e)}function o(e){A(s,r,i,a,o,"throw",e)}a(void 0)}))}}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),C(this,"model",null),C(this,"view",null),this.model=t,this.view=n,this.view.toogleAddressList(),this.createViewCallbacks(),this.onViewDidLoad()}var t,n,r,i,s,a;return t=e,(n=[{key:"createViewCallbacks",value:function(){var e=this;e.model.onDataUpdate=function(t){e.model.userMetadata=t,e.view.email.value=t.email,e.view.email.disabled=!0,console.log(t),t.addresses&&t.addresses.length>0&&(e.view.toogleAddressList(),e.view.renderAddressList(t.addresses))},e.view.updateAddressesButton.onclick=function(){var t=this.parentElement.previousElementSibling;t.innerHTML="";var n=e.view.addNewAddressNameField,r=e.view.addAddressField,i=e.view.addNewAddressTwoField,s=e.view.addNewAddressPhone,a=e.model.formUtil.verify([{field:n,name:"Full Name",checks:["not_empty","min_length"]},{field:r,name:"Address",checks:["not_empty"]},{field:s,name:"Phone",checks:["not_empty"]}]);if("invalid"!==a.status)if("yes"===r.dataset.googleAddress){var o=e.model.addAddressAutocompleteData.getPlace(),d=e.model.extractAddress(o);d.full_name=n.value,d.phone=s.value,d.id=e.guid(),i.value.trim()&&(d.address_two=i.value),e.model.saveAddressToFirebase(d).then((function(){e.view.changePopupView("change"),e.view.popup.dataset.prev=""})).catch((function(e){console.log(e),console.log("failed to save address to firebase")}))}else{var l=r.value;e.model.verifyAddress(l).then((function(t){e.view.changePopupView("verify"),e.view.showVerifyAddressBox(t),e.view.verifyAddressButton.onclick=function(){var t=document.querySelector("input[name=verify-address]:checked");t&&e.model.getGooglePlaceById(t.value).then((function(t){var r=e.model.extractAddress(t);r.full_name=n.value,r.phone=s.value,r.id=e.guid(),i.value.trim()&&(r.address_two=i.value),e.model.saveAddressToFirebase(r).then((function(){e.view.changePopupView("change"),e.view.popup.dataset.prev=""})).catch((function(e){console.log(e),console.log("failed to save address to firebase")}))})).catch((function(e){console.log(e)}))}})).catch((function(e){console.log(e)}))}else t.innerHTML=a.message},e.view.onChangeSelectedAddressButtonClicked=function(t){var n=t.target.parentElement.parentElement.dataset.id,r=t.target.parentElement.parentElement.dataset.address;e.view.setPopupSelectedAddress(r),e.view.openPopup(n,"change")},e.view.popupAddNewAddressButton.onclick=function(){e.view.changePopupView()},e.view.closePopupButton.onclick=function(){e.view.closePopup()},e.view.onSelectedAddressChange=function(t){var n=e.view.popup.dataset.field;e.view.displaySelectedAddresses(e.model.userMetadata.addresses,t,n)},e.view.billingEqualsShippingButton.onclick=function(){var t=e.view.billingAddressContainer;e.view.toggleBillingAddressSection(t)},e.view.onReviewItemQuantityChange=function(e){var t=e.target.value,n=e.target.parentElement.parentElement.dataset.qty,r=e.target.nextElementSibling;r.style.color=t&&t>0&&t!=n?"#9e1e35":"#cccccc",r.dataset.enabled=t&&t>0&&t!=n?1:0},e.view.onReviewItemQuantityLosingFocus=function(e){var t=e.target.parentElement.parentElement,n=e.target.nextElementSibling;t.dataset.qty!=e.target.value&&(e.target.value=t.dataset.qty,n.style.color="#cccccc",n.dataset.enabled=0)},e.view.onReviewItemUpdateQuantity=function(t){if(0!=t.target.dataset.enabled){var n=e.model.getCart(),r=t.target.parentElement.parentElement.dataset.id,i=t.target.previousElementSibling.value;n.length>r&&i&&(n[r].quantity=parseInt(i),n[r].subtotal=parseInt(i)*parseFloat(n[r].unit_price),e.model.setCart(n)),e.view.refreshReviewItems(e.model.getItemsData())}},e.view.onReviewItemDelete=function(t){var n=this.dataset.index,r=e.model.getCart();r.splice(n,1),e.model.setCart(r),e.view.refreshReviewItems(e.model.getItemsData())};for(var t=document.getElementsByClassName("popup-back-button"),n=0;n<t.length;n++)t[n].onclick=function(t){e.view.backToPreviousPopupView()};var r=document.querySelectorAll('#email-form input[type="submit"]');for(n=0;n<r.length;n++)r[n].onclick=function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),e.placeOrder(this)}}},{key:"onViewDidLoad",value:function(){this.avoidForm();var e=this;e.model.db=FCBH.firebaseDb,e.view.refreshReviewItems(e.model.getItemsData()),window.firebase.auth().onAuthStateChanged((function(t){e.model.user=t,e.view.setGuestElements(t),t&&e.model.getUserData(t.uid).then((function(n){n?e.model.listenForUpdates(t.uid):e.model.createNewUser(t).then((function(){e.model.listenForUpdates(t.uid)})).catch((function(e){console.log(e),console.log("problem occured creating new user")}))})).catch((function(e){console.log("error occurred - catch"),console.log(e)}))}))}},{key:"guid",value:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}},{key:"addressById",value:function(e,t){if(!t||!e||0===e.length)return!1;for(var n=0;n<e.length;n++)if(e[n].id==t)return e[n];return!1}},{key:"showError",value:function(e){var t=document.querySelector(".w-form-fail");t.style.display="block",window.scrollTo(0,t.offsetTop-150),t.textContent=e}},{key:"hideError",value:function(){document.querySelector(".w-form-fail").style.display="none"}},{key:"fetchTokens",value:(a=S(regeneratorRuntime.mark((function e(){var t,n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,FCBH.axiosInstance.get("".concat(FCBH.BASE_URL,"donate/tks"));case 2:return t=e.sent,n=t.data,r=n.csrf_token,i=n.csrf2_token,e.abrupt("return",{csrf_token:r,csrf_token_2:i});case 7:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)})},{key:"avoidForm",value:function(){this.view.form.addEventListener("submit",(function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}))}},{key:"placeOrder",value:(s=S(regeneratorRuntime.mark((function e(t){var n,r,i,s,a,o,d,l,c,u,p,h,f,v,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hideError(),0!=(n=this).model.getCart().length){e.next=5;break}return this.showError("No items in cart"),e.abrupt("return");case 5:if(r=[],i=n.view.billingEqualsShippingButton.checked,s=n.view.getCheckedShippingAddress(),console.log("data",s),s||(r=r.concat([{field:n.view.userFullName,name:"Full Name",checks:["not_empty","min_length"]},{field:n.view.email,name:"Email",checks:["not_empty","email"]},{field:n.view.guestShippingAddressField,name:"Shipping Address",checks:["not_empty"]},{field:n.view.shippingAddressCity,name:"Shipping Address City",checks:["not_empty"]},{field:n.view.shippingAddressState,name:"Shipping Address State",checks:["not_empty"]},{field:n.view.shippingAddressPostalCode,name:"Shipping Address Postal Code",checks:["not_empty"]},{field:n.view.shippingAddressCountryValue(),name:"Shipping Address Country",checks:["not_empty"],dataValue:!0}]),i||(r=r.concat([{field:n.view.billingFullName,name:"Billing Full Name",checks:["not_empty","min_length"]},{field:n.view.guestBillingAddressField,name:"Billing Address",checks:["not_empty"]},{field:n.view.billingAddressCity,name:"Billing Address City",checks:["not_empty"]},{field:n.view.billingAddressState,name:"Billing Address State",checks:["not_empty"]},{field:n.view.billingAddressPostalCode,name:"Billing Address Postal Code",checks:["not_empty"]},{field:n.view.billingAddressCountryValue(),name:"Billing Address Country",checks:["not_empty"],dataValue:!0}]))),n.model.user&&(r=r.concat([{field:n.view.emailLoggedInUser,name:"Email",checks:["not_empty","email"]}])),r=r.concat([{field:n.view.cardNumberInput,name:"Card Number",checks:["not_empty","card_num"]},{field:n.view.cardExpirationInput,name:"Card Expiration Date",checks:["not_empty"]},{field:n.view.cardCVCInput,name:"Card Security Code",checks:["not_empty"]}]),"invalid"!==(a=n.model.formUtil.verify(r)).status){e.next=17;break}return this.showError(a.message),a.input.classList.add("error"),e.abrupt("return");case 17:if(l=!0,c=[],s?(o=n.addressById(n.model.userMetadata.addresses,s.value),i?d=o:((d={id:this.guid(),address:n.view.guestBillingAddressField.value,city:n.view.billingAddressCity.value,state:n.view.billingAddressState.value,zip:n.view.billingAddressPostalCode.value,country:n.view.billingAddressCountryValue().dataset.value}).full_name=n.view.billingFullName.value,n.view.billingAddressTwo.value&&(d.address_two=n.view.billingAddressTwo.value))):((o={id:this.guid(),address:n.view.guestShippingAddressField.value,city:n.view.shippingAddressCity.value,state:n.view.shippingAddressState.value,zip:n.view.shippingAddressPostalCode.value,country:n.view.shippingAddressCountryValue().dataset.value}).full_name=n.view.userFullName.value,o.phone=n.view.phone.value||"",n.view.shippingAddressTwo.value&&(o.address_two=n.view.shippingAddressTwo.value),i?(l=!0,d=o):((d={id:this.guid(),address:n.view.guestBillingAddressField.value,city:n.view.billingAddressCity.value,state:n.view.billingAddressState.value,zip:n.view.billingAddressPostalCode.value,country:n.view.billingAddressCountryValue().dataset.value}).full_name=n.view.billingFullName.value,n.view.billingAddressTwo.value&&(d.address_two=n.view.billingAddressTwo.value)),c.push(o),i||c.push(d)),o){e.next=24;break}return this.showError("Missing or invalid shipping address."),e.abrupt("return");case 24:if(!l||d){e.next=27;break}return this.showError("Missing or invalid billing address."),e.abrupt("return");case 27:return u=n.model.getItemsData(),p=t,e.prev=29,n.view.startLoader(p),e.next=33,this.fetchTokens();case 33:return h=e.sent,f=h.csrf_token,v=h.csrf_token_2,m={email:n.model.user?n.view.emailLoggedInUser.value:n.view.email.value,card_number:btoa(n.view.cardNumberInput.value),card_expiration_date:btoa(n.view.cardExpirationInput.value),card_security_code:btoa(n.view.cardCVCInput.value),shipping_address:o,billing_address:d,items:u.items,total_cost:u.total,address_same:i,csrf_token:f,csrf_token_2:v,cssid:"3u8kfk8rej7cvflqqkskura2nt"},e.next=39,n.savingOrderHandler(t,m,c);case 39:e.next=46;break;case 41:e.prev=41,e.t0=e.catch(29),console.log("catch fail"),console.log(e.t0),n.showError("An error occurred.");case 46:return e.prev=46,p.value="Place Order",p.textContent="Place Order",e.finish(46);case 50:case"end":return e.stop()}}),e,this,[[29,41,46,50]])}))),function(e){return s.apply(this,arguments)})},{key:"savingOrderHandler",value:(i=S(regeneratorRuntime.mark((function e(t,n){var r,i,s,a,o,d,l,c=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=c.length>2&&void 0!==c[2]?c[2]:[],t&&n){e.next=3;break}return e.abrupt("return");case 3:return i=this,e.next=6,i.model.saveOrder(JSON.stringify(n));case 6:if(s=e.sent,!(s=JSON.parse(s||"{}")).status||!s.donation_info){e.next=26;break}if(a=s.status,o=atob(s.donation_info).split("|"),d=b(o,1),l=d[0],FCBH.saveToStorage(FCBH.CHECKOUT_FORM,y(y({},n),{},{card_expiration_date:null,card_number:null,card_security_code:null,card_last_digits:atob(n.card_number).substr(atob(n.card_number).length-4)})),"success"!==a){e.next=25;break}if(e.prev=13,!(r.length>0)){e.next=17;break}return e.next=17,i.model.saveAddressToFirebase(r);case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(13),console.error(e.t0);case 22:window.location="/order-confirmation1",e.next=26;break;case 25:"pending"===a||"decline"===a?i.showError(l):"token error"===a?i.showError("Your token has expired. Please refresh the page and try again."):i.showError("An error occurred. Contact Thomas at tcummings@fcbhmail.org.");case 26:case"end":return e.stop()}}),e,this,[[13,19]])}))),function(e,t){return i.apply(this,arguments)})}])&&k(t.prototype,n),r&&k(t,r),e}();window.addEventListener("load",(function(){var e=new c,t=new m;new _(e,t),new Cleave("#Payment-Info-Card-Number",{creditCard:!0}),new Cleave("#Payment-Info-Card-Expiration-Date",{date:!0,datePattern:["m","y"]})}))}});
//# sourceMappingURL=checkout.js.map